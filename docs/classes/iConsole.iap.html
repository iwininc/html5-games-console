<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>iConsole.iap</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/GettingStarted.html">GettingStarted</a></li>
            
                <li><a href="../classes/iConsole.ads.html">iConsole.ads</a></li>
            
                <li><a href="../classes/iConsole.game.html">iConsole.game</a></li>
            
                <li><a href="../classes/iConsole.iap.html">iConsole.iap</a></li>
            
                <li><a href="../classes/iConsole.periodical.html">iConsole.periodical</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1>iConsole.iap Class</h1>
<div class="box meta">
    

    

    
        <div class="foundat">
            Defined in: <a href="../files/src_console-js_modules_iap.js.html#l4"><code>src&#x2F;console-js&#x2F;modules&#x2F;iap.js:4</code></a>
        </div>
    

    

    
</div>



<div class="box intro">
    <h2 id="in-app-purchases">In App Purchases</h2>
<p>The iWin Games Console supports external In App Purchase providers, all accessible through a single API call,
which means that as a developer, you only need to write support for In App Purchases in one way, to gain support for
multiple providers and any future integrations with other IAP providers will continue to be obfuscated behind this
single call.</p>
<h2 id="currently-supported-platforms">Currently Supported Platforms</h2>
<ul>
<li>Amazon HTML5 App Store</li>
<li>Games.com</li>
<li>Yahoo Games Network</li>
</ul>
<h2 id="configuration">Configuration</h2>
<p>You will need to update the game_details.json file, to have an &quot;iap&quot; object at the root, and this should contain a
mapping of sku to an object which describes that sku:</p>
<pre>
    "iap": {
      "com.iwin.more-time" : {
          "name": "Get More Time",
          "description": "Get More Time",
          "icon": "https://s3-external-1.amazonaws.com/com-amazon-mas-catalog/M1I0LM77RX7FC2%2FM2VC2AJFZBAC93%2Fimages%2F_6b7d1378-12ae-48aa-92e2-618476ab5553_ceb500dbf0e42ce1435155dabebfb8b2",
          "currency": "usd",
          "amount": "0.99",
          "foo": "bar"
      },
      "com.iwin.more-moves" : {
          "name": "Get More Moves",
          "description": "Get More Moves",
          "icon": "https://s3-external-1.amazonaws.com/com-amazon-mas-catalog/M1I0LM77RX7FC2%2FM2VC2AJFZBAC93%2Fimages%2F_6b7d1378-12ae-48aa-92e2-618476ab5553_ceb500dbf0e42ce1435155dabebfb8b2",
          "currency": "usd",
          "amount": "0.99",
          "foo": "bar"
      },
      "com.iwin.more-midas" : {
          "name": "Get More Midas Touches",
          "description": "Get More Midas Touches",
          "icon": "https://s3-external-1.amazonaws.com/com-amazon-mas-catalog/M1I0LM77RX7FC2%2FM2VC2AJFZBAC93%2Fimages%2F_6b7d1378-12ae-48aa-92e2-618476ab5553_ceb500dbf0e42ce1435155dabebfb8b2",
          "currency": "usd",
          "amount": "1.99",
          "foo": "bar"
      },
      "com.iwin.fill-lives" : {
          "name": "Fill Lives",
          "description": "Fill Lives",
          "icon": "https://s3-external-1.amazonaws.com/com-amazon-mas-catalog/M1I0LM77RX7FC2%2FM2VC2AJFZBAC93%2Fimages%2F_6b7d1378-12ae-48aa-92e2-618476ab5553_ceb500dbf0e42ce1435155dabebfb8b2",
          "currency": "usd",
          "amount": "0.99",
          "foo": "bar"
      }
   }
</pre>
Currently (owing to restrictions from third party providers) the only currency supported is USD, and the amount should be provided as dollar.cents

You will also need to create an amazon.sdktester.json file in the root of the released game folder, which reflects the same information (just in an amazon specific manner):
<pre>
{
   "com.iwin.game-levels" : {
       "itemType" : "ENTITLED",
       "price" : "0.99",
       "title": "Unlock All Levels",
       "description": "Unlock All Levels",
       "smallIconUrl": "https://s3-external-1.amazonaws.com/com-amazon-mas-catalog/M1I0LM77RX7FC2%2FM2VC2AJFZBAC93%2Fimages%2F_6b7d1378-12ae-48aa-92e2-618476ab5553_ceb500dbf0e42ce1435155dabebfb8b2"
   },
   "com.iwin.more-time" : {
       "itemType" : "CONSUMABLE",
       "price" : "0.99",
       "title": "Get More Time",
       "description": "Get More Time",
       "smallIconUrl": "https://s3-external-1.amazonaws.com/com-amazon-mas-catalog/M1I0LM77RX7FC2%2FM2VC2AJFZBAC93%2Fimages%2F_6b7d1378-12ae-48aa-92e2-618476ab5553_ceb500dbf0e42ce1435155dabebfb8b2"
   },
   "com.iwin.more-moves" : {
       "itemType" : "CONSUMABLE",
       "price" : "0.99",
       "title": "Get More Moves",
       "description": "Get More Moves",
       "smallIconUrl": "https://s3-external-1.amazonaws.com/com-amazon-mas-catalog/M1I0LM77RX7FC2%2FM2VC2AJFZBAC93%2Fimages%2F_6b7d1378-12ae-48aa-92e2-618476ab5553_ceb500dbf0e42ce1435155dabebfb8b2"
   },
   "com.iwin.more-midas" : {
       "itemType" : "CONSUMABLE",
       "price" : "1.99",
       "title": "Get More Midas Touches",
       "description": "Get More Midas Touches",
       "smallIconUrl": "https://s3-external-1.amazonaws.com/com-amazon-mas-catalog/M1I0LM77RX7FC2%2FM2VC2AJFZBAC93%2Fimages%2F_6b7d1378-12ae-48aa-92e2-618476ab5553_ceb500dbf0e42ce1435155dabebfb8b2"
   },
   "com.iwin.fill-lives" : {
       "itemType" : "CONSUMABLE",
       "price" : "0.99",
       "title": "Fill Lives",
       "description": "Fill Lives",
       "smallIconUrl": "https://s3-external-1.amazonaws.com/com-amazon-mas-catalog/M1I0LM77RX7FC2%2FM2VC2AJFZBAC93%2Fimages%2F_6b7d1378-12ae-48aa-92e2-618476ab5553_ceb500dbf0e42ce1435155dabebfb8b2"
   }
}
</pre>

<h2 id="integration">Integration</h2>
<p>The <code><a href="iConsole.iap.html">iConsole.iap</a></code> class is the integration point that developers should use to determine if the IAP platform is supported
(i.e. that the game is running on a platform that supports IAP or not), and then to make these purchases. Once the configuration is correct, using the IAP
platform is quite simple:</p>
<pre>
// Decorate my game differently if IAP is supported
if ( <a href="iConsole.iap.html#method_isSupported">iConsole.iap.isSupported()</a> ) {
   myGame.state.buyMoreLivesEnabled = true;
   myGame.state.buyMoreMovesEnabled = true;
}

/**
 * Handler for Buy More Lives button
 *&#47;
function buyMoreLivesClicked() {
   // We don't need to test to see if IAP is supported. If it isn't supported, this call will call the failed block
   // After a short delay (i.e. after a setTimeout of 1ms)
   <a href="iConsole.iap.html#method_purchase">iConsole.iap.purchase('buymorelivessku')</a>
      .success(purchaseSuccess)
      .failure(purchaseFailure);
}

/**
 * Handler for when a purchase succeeds
 *&#47;
function purchaseSuccess(sku) {
   switch (sku) {
      case 'buymorelivessku':
         myGame.state.lives += 5;
         break;
      case 'buymoremovessku':
         myGame.state.moves += 10;
         break;
   }
}
/**
 * Handler for when a purchase succeeds
 *&#47;
function purchaseFailure(sku) {
   console.log('Purchase failed for sku=' + sku );
}
</pre>

<h2 id="launching-testing">Launching / Testing</h2>
<p>Normally, a console enabled game is launched (on a local development server, with host file entry of
<code>127.0.0.1 local.games.iwin.com</code>) with
<a href="http://local.games.iwin.com/#/game/"><a href="http://local.games.iwin.com/#/game/">http://local.games.iwin.com/#/game/</a></a> where the folder after the # symbol tells
the console where to laod the game from. You can append on to this URL, the following</p>
<ul>
<li>&#35;!amazon to enable Amazon integration<ul>
<li><a href="http://local.games.iwin.com/#/game/#!amazon"><a href="http://local.games.iwin.com/#/game/#!amazon">http://local.games.iwin.com/#/game/#!amazon</a></a></li>
</ul>
</li>
<li>&#35;!gamescom to enable Games.com integration<ul>
<li><a href="http://local.games.iwin.com/#/game/#!gamescom"><a href="http://local.games.iwin.com/#/game/#!gamescom">http://local.games.iwin.com/#/game/#!gamescom</a></a></li>
</ul>
</li>
<li>&#35;!yahoo to enable Yahoo integration<ul>
<li><a href="http://local.games.iwin.com/#/game/#!yahoo"><a href="http://local.games.iwin.com/#/game/#!yahoo">http://local.games.iwin.com/#/game/#!yahoo</a></a></li>
</ul>
</li>
</ul>
<h3 id="amazon">Amazon</h3>
<p>This is the simplest integration to test, as it works out of the box, and does not require any special work-arounds
or notes. In App Purchases complete when you attempt them without costing real money.</p>
<h3 id="games-com">Games.com</h3>
<p>The games.com integration requires you to configure a HTML5 game in <a href="http://developer.games.com"><a href="http://developer.games.com">http://developer.games.com</a></a>
and to insert this link (for initial testing purposes) in the externally hosted URL. Also, their In App Purchasing
opens up a pop-up window which may be automatically blocked (which means your purchases will fail), so be aware of
this issue. When making a purchase, you can use the magic credit card 4444444444444448 (with any other value for the
rest of the fields).</p>
<h3 id="yahoo">Yahoo</h3>
<p>You will need to set up an externally hosted Canvas game in the Yahoo development. The remainder of this integration
remains un-documented.</p>
<h2 id="further-platform-integration">Further Platform Integration</h2>
<p>Beyond In-App-Purchasing, these platforms also offer other services, which are supported by the Console:</p>
<h3 id="amazon">Amazon</h3>
<ul>
<li>amazonmotiongesturetilt - When on a Fire Phone, you can tilt the phone around it&#39;s Y axis, which Amazon request is used
to hide any menus. This has been exposed in the iConsole as:<pre><a href="iConsole.game.html#method_onEvent">iConsole.game.onEvent('tiltYaxis', function(...){...});</a></pre></li>
<li>Home widget label - When the App is installed onto an Amazon device, it has space for a label below the icon on the
home screen. Typically, this can be used to provide contextual information about the user&#39;s progress in the game, such
as which level they are on. This is available as:<pre><a href="iConsole.game.html#method_setHomeWidgetLabel">iConsole.game.setHomeWidgetLabel('Continue playing from level 9');</a></pre>

</li>
</ul>
<h3 id="games-com">Games.com</h3>
<ul>
<li>All user data is stored on the Games.com servers rather than the iWin Servers</li>
</ul>

</div>



<div id="classdocs" class="tabview">
    <ul class="api-class-tabs">
        <li class="api-class-tab index"><a href="#index">Index</a></li>

        
            <li class="api-class-tab methods"><a href="#methods">Methods</a></li>
        
        
        
        
    </ul>

    <div>
        <div id="index" class="api-class-tabpanel index">
            <h2 class="off-left">Item Index</h2>

            
                <div class="index-section methods">
                    <h3>Methods</h3>

                    <ul class="index-list methods">
                        
                            <li class="index-item method">
                                <a href="#method_getConsoleProvider">getConsoleProvider</a>

                                
                                
                            </li>
                        
                            <li class="index-item method">
                                <a href="#method_isAnalyticsSupported">isAnalyticsSupported</a>

                                
                                
                            </li>
                        
                            <li class="index-item method">
                                <a href="#method_isSupported">isSupported</a>

                                
                                
                            </li>
                        
                            <li class="index-item method">
                                <a href="#method_purchase">purchase</a>

                                
                                
                            </li>
                        
                    </ul>
                </div>
            

            

            

            
        </div>

        
            <div id="methods" class="api-class-tabpanel">
                <h2 class="off-left">Methods</h2>

                
                    <div id="method_getConsoleProvider" class="method item">
    <h3 class="name"><code>getConsoleProvider</code></h3>

    
        <span class="paren">()</span>
    

    
        <span class="returns-inline">
            <span class="type">String</span>
        </span>
    

    

    

    

    

    

    

    <div class="meta">
        
            
                
                <p>
                
                Defined in
                
            
        
        
        <a href="../files/src_console-js_modules_iap.js.html#l257"><code>src&#x2F;console-js&#x2F;modules&#x2F;iap.js:257</code></a>
        
        </p>


        

        
    </div>

    <div class="description">
        <p>This function will return the provider that the console is running under, which can be used to target
different analytics accounts</p>

    </div>

    

    
        <div class="returns">
            <h4>Returns:</h4>

            <div class="returns-description">
                
                    
                        <span class="type">String</span>:
                    
                
            </div>
        </div>
    

    
</div>

                
                    <div id="method_isAnalyticsSupported" class="method item">
    <h3 class="name"><code>isAnalyticsSupported</code></h3>

    
        <span class="paren">()</span>
    

    
        <span class="returns-inline">
            <span class="type">Boolean</span>
        </span>
    

    

    

    

    

    

    

    <div class="meta">
        
            
                
                <p>
                
                Defined in
                
            
        
        
        <a href="../files/src_console-js_modules_iap.js.html#l246"><code>src&#x2F;console-js&#x2F;modules&#x2F;iap.js:246</code></a>
        
        </p>


        

        
    </div>

    <div class="description">
        <p>This function should be used to feature detect whether external analytics (like Flurry) should be used for
the game. Note that if your game presents a different experience for an IAP game versus a non-IAP game, you
should store your analytic events accordingly.</p>

    </div>

    

    
        <div class="returns">
            <h4>Returns:</h4>

            <div class="returns-description">
                
                    
                        <span class="type">Boolean</span>:
                    
                
            </div>
        </div>
    

    
</div>

                
                    <div id="method_isSupported" class="method item">
    <h3 class="name"><code>isSupported</code></h3>

    
        <span class="paren">()</span>
    

    
        <span class="returns-inline">
            <span class="type">Boolean</span>
        </span>
    

    

    

    

    

    

    

    <div class="meta">
        
            
                
                <p>
                
                Defined in
                
            
        
        
        <a href="../files/src_console-js_modules_iap.js.html#l198"><code>src&#x2F;console-js&#x2F;modules&#x2F;iap.js:198</code></a>
        
        </p>


        

        
    </div>

    <div class="description">
        <p>This function should be used to feature detect whether In App Purchasing is available or not.</p>

    </div>

    

    
        <div class="returns">
            <h4>Returns:</h4>

            <div class="returns-description">
                
                    
                        <span class="type">Boolean</span>:
                    
                
            </div>
        </div>
    

    
</div>

                
                    <div id="method_purchase" class="method item">
    <h3 class="name"><code>purchase</code></h3>

    
        <div class="args">
            <span class="paren">(</span><ul class="args-list inline commas">
            
                <li class="arg">
                    
                        <code>sku</code>
                    
                </li>
            
            </ul><span class="paren">)</span>
        </div>
    

    
        <span class="returns-inline">
            <span class="type">Object</span>
        </span>
    

    

    

    

    

    

    

    <div class="meta">
        
            
                
                <p>
                
                Defined in
                
            
        
        
        <a href="../files/src_console-js_modules_iap.js.html#l207"><code>src&#x2F;console-js&#x2F;modules&#x2F;iap.js:207</code></a>
        
        </p>


        

        
    </div>

    <div class="description">
        <p>This function should be used to initiate an In App Purchase from the containing platform. If the sku doesn&#39;t
exist in the game_details.json, or in amazon&#39;s case, configured on their server this function will call the
failure callback.</p>

    </div>

    
        <div class="params">
            <h4>Parameters:</h4>

            <ul class="params-list">
            
                <li class="param">
                    
                        <code class="param-name">sku</code>
                        <span class="type">String</span>
                    

                    

                    <div class="param-description">
                        <p>The sku item you wish to purchase</p>

                    </div>

                    
                </li>
            
            </ul>
        </div>
    

    
        <div class="returns">
            <h4>Returns:</h4>

            <div class="returns-description">
                
                    
                        <span class="type">Object</span>:
                    
                    <p>An object which contains two functions, success and failure, which should each be called
with the function you wish to call when the purchase succeeds or fails. These callbacks will be called a
single parameter, the sku that was attempted to be purchased. These calls can be directly chained:</p>

                
            </div>
        </div>
    

    
        <div class="example">
            <h4>Example:</h4>

            <div class="example-content">
                <pre>
    iConsole.iap.purchase('com.iwin.morelives').success(mySuccessFunction).failure(myFailureFunction);
</pre>
            </div>
        </div>
    
</div>

                
            </div>
        

        

        

        
    </div>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
